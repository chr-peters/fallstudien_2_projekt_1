---
title: "XGBoost"
output:
  pdf_document:
    toc: true
    toc_depth: 2
    number_sections: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, message=FALSE}
library(tidyverse)
library(ggplot2)

library(mlr3)
library(mlr3learners)
library(mlr3pipelines)
library(mlr3tuning)
library(mlr3filters)
library(paradox)
```

```{r}
future::plan("multiprocess")
```

# Upload-Rate Prediction

## Reading the Data

```{r}
data_dir = "../datasets/"

dataset_ul = read_csv(
  str_c(data_dir, "dataset_ul.csv"), 
  col_types = cols(
    drive_id = col_integer(),
    scenario = col_factor(), 
    provider = col_factor(), 
    ci = col_factor(), 
    enodeb = col_factor()
  )
) %>% select(
  drive_id,
  timestamp,
  scenario,
  provider,
  velocity_mps,
  acceleration_mpss,
  rsrp_dbm,
  rsrq_db,
  rssnr_db,
  cqi,
  ta,
  enodeb,
  f_mhz,
  payload_mb,
  throughput_mbits
) %>% drop_na() %>% rowid_to_column(var="row_id_original")
```

```{r}
dataset_ul_o2 = filter(dataset_ul, provider=="o2")
glimpse(dataset_ul_o2)

dataset_ul_tmobile = filter(dataset_ul, provider=="tmobile")
glimpse(dataset_ul_tmobile)

dataset_ul_vodafone = filter(dataset_ul, provider=="vodafone")
glimpse(dataset_ul_vodafone)
```

## Create the Prediction Tasks for Each Provider

```{r}
make_task = function(dataset, task_id) {
  task = TaskRegr$new(
    id = task_id,
    backend = dataset %>% select(-drive_id, -timestamp, -provider, -scenario),
    target = "throughput_mbits"
  )
  
  task$col_roles$name = "row_id_original"
  task$col_roles$feature = setdiff(task$col_roles$feature, "row_id_original")
  
  return(task)
}

task_ul_o2 = make_task(dataset_ul_o2, "task_ul_o2")
task_ul_o2

task_ul_tmobile = make_task(dataset_ul_tmobile, "task_ul_tmobile")
task_ul_tmobile

task_ul_vodafone = make_task(dataset_ul_vodafone, "task_ul_vodafone")
task_ul_vodafone
```

## Create Data Splitting Strategies for Testing and Validation

The outer resampling is used for the train/validation split.
```{r}
get_row_ids_by_drive_ids = function(task, dataset, drive_ids) {
  result = (tibble(task$row_names) %>% 
    inner_join(dataset, by=c("row_name"="row_id_original")) %>%
    filter(drive_id %in% drive_ids))$row_id
  return(result)
}

make_outer_resampling = function(task, dataset, drive_ids_train, drive_ids_test) {
  row_ids_train = get_row_ids_by_drive_ids(task, dataset, drive_ids_train)
  row_ids_test = get_row_ids_by_drive_ids(task, dataset, drive_ids_test)
  
  result = rsmp("custom")
  result$instantiate(task, train_sets=list(row_ids_train), test_sets=list(row_ids_test))
  
  return(result)
}
```

The inner resampling is used for the parameter tuning on the training set.
```{r}
make_inner_resampling = function(task, dataset, last_drive_id) {
  train_sets = list()
  test_sets = list()
  
  for (cur_last_drive_id_train in 2:(last_drive_id-1)) {
    drive_ids_train = 1:cur_last_drive_id_train
    drive_ids_test = cur_last_drive_id_train + 1
    
    row_ids_train = get_row_ids_by_drive_ids(task, dataset, drive_ids_train)
    row_ids_test = get_row_ids_by_drive_ids(task, dataset, drive_ids_test)
    
    train_sets[[length(train_sets)+1]] = row_ids_train
    test_sets[[length(test_sets)+1]] = row_ids_test
  }
  
  result = rsmp("custom")
  result$instantiate(task, train_sets=train_sets, test_sets=test_sets)
  
  return(result)
}
```

## Create the Prediction Pipeline

```{r}
make_learner = function(nrounds=100, eta=NULL, gamma=NULL, lambda=NULL) {
  factor_encoding = po(
    "encode",
    method = "one-hot",
    affect_columns = selector_type("factor")
  )
  xgboost = lrn("regr.xgboost")
  
  if (!is.null(nrounds)) {
    xgboost$param_set$values = mlr3misc::insert_named(
      xgboost$param_set$values,
      list(nrounds=nrounds)
    )
  }
  if (!is.null(eta)) {
    xgboost$param_set$values = mlr3misc::insert_named(
      xgboost$param_set$values,
      list(eta=eta)
    )
  }
  if (!is.null(gamma)) {
    xgboost$param_set$values = mlr3misc::insert_named(
      xgboost$param_set$values,
      list(gamma=gamma)
    )
  }
  if (!is.null(lambda)) {
    xgboost$param_set$values = mlr3misc::insert_named(
      xgboost$param_set$values,
      list(lambda=lambda)
    )
  }
  
  pipe = factor_encoding %>>% PipeOpLearner$new(xgboost)
  learner = GraphLearner$new(pipe)
  return(learner)
}
```

Here we can see the prediction pipeline:
```{r}
make_learner()$graph$plot()
```

## Parameter Tuning

```{r}
parameter_space = ParamSet$new(list(
  ParamInt$new("regr.xgboost.nrounds", lower=100, upper=1000),
  ParamDbl$new("regr.xgboost.eta", lower=0.01, upper=1),
  ParamDbl$new("regr.xgboost.gamma", lower=0, upper=10),
  ParamDbl$new("regr.xgboost.lambda", lower=0, upper=10)
))
```

```{r}
get_tuning_result = function(task, dataset, grid_resolution, n_evals) {
  tuning_instance = TuningInstanceSingleCrit$new(
    task = task,
    learner = make_learner(),
    resampling = make_inner_resampling(task, dataset, last_drive_id=7),
    measure = msr("regr.mae"),
    terminator = trm("evals", n_evals=n_evals),
    search_space = parameter_space$clone(deep = TRUE),
    store_benchmark_result = TRUE,
    check_values = TRUE
  )
  
  tuner = tnr("grid_search", resolution = grid_resolution)
  tuner$optimize(tuning_instance)
  
  return(tuning_instance)
}
```

```{r, results = "hide"}
tuning_result_o2 = get_tuning_result(task_ul_o2, dataset_ul, grid_resolution = 20, n_evals = 10)

tuning_result_tmobile = get_tuning_result(task_ul_tmobile, dataset_ul, grid_resolution = 20, n_evals = 10)

tuning_result_vodafone = get_tuning_result(task_ul_vodafone, dataset_ul, grid_resolution = 20, n_evals = 10)
```

```{r}
tuning_result_o2$result
tuning_result_tmobile$result
tuning_result_vodafone$result
```

## Create Learners with Tuned Hyperparameters

```{r}
learner_ul_o2 = make_learner(
  nrounds = tuning_result_o2$result$regr.xgboost.nrounds,
  eta = tuning_result_o2$result$regr.xgboost.eta,
  gamma = tuning_result_o2$result$regr.xgboost.gamma,
  lambda = tuning_result_o2$result$regr.xgboost.lambda
)

learner_ul_tmobile = make_learner(
  nrounds = tuning_result_tmobile$result$regr.xgboost.nrounds,
  eta = tuning_result_tmobile$result$regr.xgboost.eta,
  gamma = tuning_result_tmobile$result$regr.xgboost.gamma,
  lambda = tuning_result_tmobile$result$regr.xgboost.lambda
)

learner_ul_vodafone = make_learner(
  nrounds = tuning_result_vodafone$result$regr.xgboost.nrounds,
  eta = tuning_result_vodafone$result$regr.xgboost.eta,
  gamma = tuning_result_vodafone$result$regr.xgboost.gamma,
  lambda = tuning_result_vodafone$result$regr.xgboost.lambda
)
```

## Validation Results

```{r, results = "hide"}
resampling_result_ul_o2 = resample(
  task = task_ul_o2,
  learner = learner_ul_o2,
  resampling = make_outer_resampling(task_ul_o2, dataset_ul, drive_ids_train=1:7, drive_ids_test=8:10),
  store_models = TRUE
)

resampling_result_ul_tmobile = resample(
  task = task_ul_tmobile,
  learner = learner_ul_tmobile,
  resampling = make_outer_resampling(task_ul_tmobile, dataset_ul, drive_ids_train=1:7, drive_ids_test=8:10),
  store_models = TRUE
)

resampling_result_ul_vodafone = resample(
  task = task_ul_vodafone,
  learner = learner_ul_vodafone,
  resampling = make_outer_resampling(task_ul_vodafone, dataset_ul, drive_ids_train=1:7, drive_ids_test=8:10),
  store_models = TRUE
)
```

```{r}
predictions_ul_o2 = as.data.table(resampling_result_ul_o2$prediction())
glimpse(tibble(predictions_ul_o2))
predictions_ul_tmobile = as.data.table(resampling_result_ul_tmobile$prediction())
predictions_ul_vodafone = as.data.table(resampling_result_ul_vodafone$prediction())
```

```{r}
validation_results_ul = bind_rows(
  tibble(predictions_ul_o2) %>% 
    inner_join(tibble(task_ul_o2$row_names), by="row_id") %>% 
    inner_join(dataset_ul, by=c("row_name"="row_id_original")),
  tibble(predictions_ul_tmobile) %>% 
    inner_join(tibble(task_ul_tmobile$row_names), by="row_id") %>% 
    inner_join(dataset_ul, by=c("row_name"="row_id_original")),
  tibble(predictions_ul_vodafone) %>% 
    inner_join(tibble(task_ul_vodafone$row_names), by="row_id") %>% 
    inner_join(dataset_ul, by=c("row_name"="row_id_original"))
)
glimpse(validation_results_ul)
```

```{r}
all(validation_results_ul$truth == validation_results_ul$throughput_mbits)
```

### Scatter Plots

```{r}
ggplot(filter(validation_results_ul, provider=="o2"), aes(x=truth, y=response)) +
  geom_point(aes(color=scenario, shape=scenario)) +
  xlab("Measured Data Rate [MBit/s]") +
  ylab("Predicted Data Rate [MBit/s]") +
  ggtitle("Upload-Rate Predictions for Provider O2")
```

```{r}
ggplot(filter(validation_results_ul, provider=="tmobile"), aes(x=truth, y=response)) +
  geom_point(aes(color=scenario, shape=scenario)) +
  xlab("Measured Data Rate [MBit/s]") +
  ylab("Predicted Data Rate [MBit/s]") +
  ggtitle("Upload-Rate Predictions for Provider T-Mobile")
```

```{r}
ggplot(filter(validation_results_ul, provider=="vodafone"), aes(x=truth, y=response)) +
  geom_point(aes(color=scenario, shape=scenario)) +
  xlab("Measured Data Rate [MBit/s]") +
  ylab("Predicted Data Rate [MBit/s]") +
  ggtitle("Upload-Rate Predictions for Provider Vodafone")
```

### Performance Measures

```{r}
compute_measure = function(measure, dataset, truth_column, response_column, providers, scenarios) {
  data_subset = filter(dataset, provider %in% providers, scenario %in% scenarios)
  truth = data_subset[[truth_column]]
  response = data_subset[[response_column]]
  
  tmp_prediction = PredictionRegr$new(
    row_ids = seq_along(truth),
    truth = truth,
    response = response
  )
  
  result = measure$score(tmp_prediction)
  return(result)
}
```

```{r}
scenarios = c("campus", "suburban", "highway", "urban")
providers = c("o2", "tmobile", "vodafone")

results_by_provider = tibble()
for (cur_provider in providers) {
  cur_rsq = compute_measure(
    measure = msr("regr.rsq"),
    dataset = validation_results_ul, 
    truth_column = "truth", 
    response_column = "response", 
    providers = cur_provider,
    scenarios = scenarios
  )
  cur_mae = compute_measure(
    measure = msr("regr.mae"),
    dataset = validation_results_ul, 
    truth_column = "truth", 
    response_column = "response", 
    providers = cur_provider,
    scenarios = scenarios
  )
  
  results_by_provider = bind_rows(results_by_provider, list("provider"=cur_provider, "rsq"=cur_rsq, "mae"=cur_mae))
}

results_by_scenario = tibble()
for (cur_scenario in scenarios) {
  cur_rsq = compute_measure(
    measure = msr("regr.rsq"),
    dataset = validation_results_ul, 
    truth_column = "truth", 
    response_column = "response", 
    providers = providers,
    scenarios = cur_scenario
  )
  cur_mae = compute_measure(
    measure = msr("regr.mae"),
    dataset = validation_results_ul, 
    truth_column = "truth", 
    response_column = "response", 
    providers = providers,
    scenarios = cur_scenario
  )
  
  results_by_scenario = bind_rows(results_by_scenario, list("scenario"=cur_scenario, "rsq"=cur_rsq, "mae"=cur_mae))
}

results_by_provider_and_scenario = tibble()
for (cur_provider in providers) {
  for (cur_scenario in scenarios) {
    cur_rsq = compute_measure(
      measure = msr("regr.rsq"),
      dataset = validation_results_ul, 
      truth_column = "truth", 
      response_column = "response", 
      providers = cur_provider,
      scenarios = cur_scenario
    )
    cur_mae = compute_measure(
      measure = msr("regr.mae"),
      dataset = validation_results_ul, 
      truth_column = "truth", 
      response_column = "response", 
      providers = cur_provider,
      scenarios = cur_scenario
    )
    
    results_by_provider_and_scenario = bind_rows(
      results_by_provider_and_scenario, 
      list(
        provider = cur_provider,
        scenario = cur_scenario,
        rsq=cur_rsq, 
        mae=cur_mae
      )
    )
  }
}
```

```{r}
knitr::kable(results_by_provider)
knitr::kable(results_by_scenario)
knitr::kable(results_by_provider_and_scenario)
```

```{r}
ggplot(results_by_provider, aes(x=provider, y=rsq)) +
  geom_bar(stat = "identity") +
  ylim(c(0, 1)) +
  ggtitle("R^2 by Provider")

ggplot(results_by_provider, aes(x=provider, y=mae)) +
  geom_bar(stat = "identity") +
  ggtitle("MAE by Provider")
```

```{r}
ggplot(results_by_scenario, aes(x=scenario, y=rsq)) +
  geom_bar(stat = "identity") +
  ylim(c(0, 1)) +
  ggtitle("R^2 by Scenario")

ggplot(results_by_scenario, aes(x=scenario, y=mae)) +
  geom_bar(stat = "identity") +
  ggtitle("MAE by Scenario")
```

```{r}
ggplot(results_by_provider_and_scenario, aes(x=scenario, y=rsq, fill=provider)) +
  geom_bar(position = "dodge", stat = "identity") +
  ggtitle("R^2 by Provider and Scenario")

ggplot(results_by_provider_and_scenario, aes(x=scenario, y=mae, fill=provider)) +
  geom_bar(position = "dodge", stat = "identity") +
  ggtitle("MAE by Provider and Scenario")
```

## Feature Importance

### XGBoost Gain

```{r}
importance_ul_o2 = tibble(xgboost::xgb.importance(
  feature_names = resampling_result_ul_o2$learners[[1]]$model$regr.xgboost$model$feature_names,
  model = resampling_result_ul_o2$learners[[1]]$model$regr.xgboost$model
)) %>% mutate(provider = "o2")
importance_ul_tmobile = tibble(xgboost::xgb.importance(
  feature_names = resampling_result_ul_tmobile$learners[[1]]$model$regr.xgboost$model$feature_names,
  model = resampling_result_ul_tmobile$learners[[1]]$model$regr.xgboost$model
)) %>% mutate(provider = "tmobile")
importance_ul_vodafone = tibble(xgboost::xgb.importance(
  feature_names = resampling_result_ul_vodafone$learners[[1]]$model$regr.xgboost$model$feature_names,
  model = resampling_result_ul_vodafone$learners[[1]]$model$regr.xgboost$model
)) %>% mutate(provider = "vodafone")

importance_ul = bind_rows(
  importance_ul_o2,
  importance_ul_tmobile,
  importance_ul_vodafone
) %>% filter(!str_starts(Feature, "enodeb"))
```

```{r}
ggplot(importance_ul) +
  geom_bar(position = "dodge", aes(x = Feature, y = Gain, fill = provider), stat="identity") +
  xlab("feature") +
  ylab("Gain") +
  scale_x_discrete(guide = guide_axis(angle = 20)) +
  ggtitle("XGBoost Gain Feature Importance")
```

### Permutation

```{r}
uninstantiate_resampling = function(resampling) {
  new_resampling = new.env()
  class(new_resampling) = class(resampling)
  for (val in ls(resampling, all.names = TRUE)) {
    if (val != "is_instantiated") {
      assign(val, get(val, envir=resampling), envir = new_resampling)
    }
  }
  new_resampling$is_instantiated = FALSE
  
  return(new_resampling)
}
```

```{r, results='hide'}
num_permutation_sims_ul = 1

filter_permutation_o2 = flt("permutation",
  learner = learner_ul_o2$clone(),
  resampling = uninstantiate_resampling(
    make_outer_resampling(task_ul_o2, dataset_ul, drive_ids_train=1:7, drive_ids_test=8:10)
  ),
  measure = msr("regr.mae"),
  standardize = TRUE,
  nmc=num_permutation_sims_ul
)
filter_permutation_o2$calculate(task_ul_o2)
permutation_ul_o2 = tibble(as.data.table(filter_permutation_o2)) %>% mutate(provider="o2")

filter_permutation_tmobile = flt("permutation",
  learner = learner_ul_tmobile$clone(),
  resampling = uninstantiate_resampling(
    make_outer_resampling(task_ul_tmobile, dataset_ul, drive_ids_train=1:7, drive_ids_test=8:10)
  ),
  measure = msr("regr.mae"),
  standardize = TRUE,
  nmc=num_permutation_sims_ul
)
filter_permutation_tmobile$calculate(task_ul_tmobile)
permutation_ul_tmobile = tibble(as.data.table(filter_permutation_tmobile)) %>% mutate(provider="tmobile")

filter_permutation_vodafone = flt("permutation",
  learner = learner_ul_vodafone$clone(),
  resampling = uninstantiate_resampling(
    make_outer_resampling(task_ul_vodafone, dataset_ul, drive_ids_train=1:7, drive_ids_test=8:10)
  ),
  measure = msr("regr.mae"),
  standardize = TRUE,
  nmc=num_permutation_sims_ul
)
filter_permutation_vodafone$calculate(task_ul_vodafone)
permutation_ul_vodafone = tibble(as.data.table(filter_permutation_vodafone)) %>% mutate(provider="vodafone")

permutation_ul = bind_rows(
  permutation_ul_o2,
  permutation_ul_tmobile,
  permutation_ul_vodafone
)
```

```{r}
ggplot(permutation_ul) +
  geom_bar(position = "dodge", aes(x = feature, y = score, fill = provider), stat="identity") +
  xlab("feature") +
  ylab("MAE difference") +
  scale_x_discrete(guide = guide_axis(angle = 20)) +
  ggtitle("Permutation Feature Importance")
```


# Download-Rate Prediction

## Reading the Data

```{r}
dataset_dl = read_csv(
  str_c(data_dir, "dataset_dl.csv"), 
  col_types = cols(
    drive_id = col_integer(),
    scenario = col_factor(), 
    provider = col_factor(), 
    ci = col_factor(), 
    enodeb = col_factor()
  )
) %>% select(
  drive_id,
  timestamp,
  scenario,
  provider,
  velocity_mps,
  acceleration_mpss,
  rsrp_dbm,
  rsrq_db,
  rssnr_db,
  cqi,
  ta,
  enodeb,
  f_mhz,
  payload_mb,
  throughput_mbits
) %>% drop_na() %>% rowid_to_column(var="row_id_original")
```

```{r}
dataset_dl_o2 = filter(dataset_dl, provider=="o2")
glimpse(dataset_dl_o2)

dataset_dl_tmobile = filter(dataset_dl, provider=="tmobile")
glimpse(dataset_dl_tmobile)

dataset_dl_vodafone = filter(dataset_dl, provider=="vodafone")
glimpse(dataset_dl_vodafone)
```

## Create the Prediction Tasks for Each Provider

```{r}
task_dl_o2 = make_task(dataset_dl_o2, "task_dl_o2")
task_dl_o2

task_dl_tmobile = make_task(dataset_dl_tmobile, "task_dl_tmobile")
task_dl_tmobile

task_dl_vodafone = make_task(dataset_dl_vodafone, "task_dl_vodafone")
task_dl_vodafone
```

## Parameter Tuning

```{r, results = "hide"}
tuning_result_dl_o2 = get_tuning_result(task_dl_o2, dataset_dl, grid_resolution = 20, n_evals = 10)

tuning_result_dl_tmobile = get_tuning_result(task_dl_tmobile, dataset_dl, grid_resolution = 20, n_evals = 10)

tuning_result_dl_vodafone = get_tuning_result(task_dl_vodafone, dataset_dl, grid_resolution = 20, n_evals = 10)
```

```{r}
tuning_result_dl = bind_rows(
  tibble(tuning_result_dl_o2$result) %>% mutate(provider="o2"),
  tibble(tuning_result_dl_tmobile$result) %>% mutate(provider="tmobile"),
  tibble(tuning_result_dl_vodafone$result) %>% mutate(provider="vodafone"),
) %>% select("provider", "regr.xgboost.nrounds", "regr.xgboost.eta", "regr.xgboost.gamma", "regr.xgboost.lambda")
knitr::kable(tuning_result_dl)
```

## Create Learners with Tuned Hyperparameters

```{r}
learner_dl_o2 = make_learner(
  nrounds = tuning_result_dl_o2$result$regr.xgboost.nrounds,
  eta = tuning_result_dl_o2$result$regr.xgboost.eta,
  gamma = tuning_result_dl_o2$result$regr.xgboost.gamma,
  lambda = tuning_result_dl_o2$result$regr.xgboost.lambda
)

learner_dl_tmobile = make_learner(
  nrounds = tuning_result_dl_tmobile$result$regr.xgboost.nrounds,
  eta = tuning_result_dl_tmobile$result$regr.xgboost.eta,
  gamma = tuning_result_dl_tmobile$result$regr.xgboost.gamma,
  lambda = tuning_result_dl_tmobile$result$regr.xgboost.lambda
)

learner_dl_vodafone = make_learner(
  nrounds = tuning_result_dl_vodafone$result$regr.xgboost.nrounds,
  eta = tuning_result_dl_vodafone$result$regr.xgboost.eta,
  gamma = tuning_result_dl_vodafone$result$regr.xgboost.gamma,
  lambda = tuning_result_dl_vodafone$result$regr.xgboost.lambda
)
```

## Validation Results

```{r, results = "hide"}
resampling_result_dl_o2 = resample(
  task = task_dl_o2,
  learner = learner_dl_o2,
  resampling = make_outer_resampling(task_dl_o2, dataset_dl, drive_ids_train=1:7, drive_ids_test=8:10),
  store_models = TRUE
)

resampling_result_dl_tmobile = resample(
  task = task_dl_tmobile,
  learner = learner_dl_tmobile,
  resampling = make_outer_resampling(task_dl_tmobile, dataset_dl, drive_ids_train=1:7, drive_ids_test=8:10),
  store_models = TRUE
)

resampling_result_dl_vodafone = resample(
  task = task_dl_vodafone,
  learner = learner_dl_vodafone,
  resampling = make_outer_resampling(task_dl_vodafone, dataset_dl, drive_ids_train=1:7, drive_ids_test=8:10),
  store_models = TRUE
)
```

```{r}
predictions_dl_o2 = as.data.table(resampling_result_dl_o2$prediction())
glimpse(tibble(predictions_dl_o2))
predictions_dl_tmobile = as.data.table(resampling_result_dl_tmobile$prediction())
predictions_dl_vodafone = as.data.table(resampling_result_dl_vodafone$prediction())
```

```{r}
validation_results_dl = bind_rows(
  tibble(predictions_dl_o2) %>% 
    inner_join(tibble(task_dl_o2$row_names), by="row_id") %>% 
    inner_join(dataset_dl, by=c("row_name"="row_id_original")),
  tibble(predictions_dl_tmobile) %>% 
    inner_join(tibble(task_dl_tmobile$row_names), by="row_id") %>% 
    inner_join(dataset_dl, by=c("row_name"="row_id_original")),
  tibble(predictions_dl_vodafone) %>% 
    inner_join(tibble(task_dl_vodafone$row_names), by="row_id") %>% 
    inner_join(dataset_dl, by=c("row_name"="row_id_original"))
)
glimpse(validation_results_dl)
```

```{r}
all(validation_results_dl$truth == validation_results_dl$throughput_mbits)
```

### Scatter Plots

```{r}
ggplot(filter(validation_results_dl, provider=="o2"), aes(x=truth, y=response)) +
  geom_point(aes(color=scenario, shape=scenario)) +
  xlab("Measured Data Rate [MBit/s]") +
  ylab("Predicted Data Rate [MBit/s]") +
  ggtitle("Download-Rate Predictions for Provider O2")
```

```{r}
ggplot(filter(validation_results_dl, provider=="tmobile"), aes(x=truth, y=response)) +
  geom_point(aes(color=scenario, shape=scenario)) +
  xlab("Measured Data Rate [MBit/s]") +
  ylab("Predicted Data Rate [MBit/s]") +
  ggtitle("Download-Rate Predictions for Provider T-Mobile")
```

```{r}
ggplot(filter(validation_results_dl, provider=="vodafone"), aes(x=truth, y=response)) +
  geom_point(aes(color=scenario, shape=scenario)) +
  xlab("Measured Data Rate [MBit/s]") +
  ylab("Predicted Data Rate [MBit/s]") +
  ggtitle("Download-Rate Predictions for Provider Vodafone")
```